name: test

on:
  push:
    tags-ignore:
      - v*
    branches:
      - 'dev'

jobs:
  test:
    name: test
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]

    steps: 
    - uses: actions/checkout@v2
    - name: Checkout submodules
      run: git submodule update --init --force --recursive
    - uses: Jimver/cuda-toolkit@v0.2.6
      id: cuda-toolkit
      with:
        cuda: '11.7.0'
    - name: test
      run: |
        mkdir -p build && cd build
        cmake .. -DBUILD_ALL=ON -DBUILD_TEST=ON -DBUILD_BACKEND_CUDA=ON
        cmake --build . --config Release --parallel 8 --target test_autd3
        ./tests/test_autd3
